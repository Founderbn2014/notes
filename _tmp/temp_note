## git-hooks

```bash
git_dir=$(pwd)
git_branch=$(git rev-parse --abbrev-ref HEAD)
work_dir=/path/to/dirs/$(echo $(pwd)|awk '{cnt=gsub("/","_");print "some_str"$0}')

mkdir -p "$work_dir"
GIT_WORK_TREE=$work_dir GIT_DIR=$git_dir git checkout -f $git_branch

lint_files=$(git diff --name-only HEAD HEAD~1)
if [[ "a$lint_files" = "a" ]]; then
    exit 0
fi

# do some scripts
exit 0
```

## systemd services

```bash
# cat /usr/lib/systemd/system/tomcat.service

[Unit] 
Description=Apache Tomcat Web Application Container 
After=network.target 
[Service] 
Type=forking 
ExecStart=/opt/apache-tomcat/bin/startup.sh 
ExecStop=/opt/apache-tomcat/bin/shutdown.sh 
[Install] 
WantedBy=multi-user.target 

# cat /usr/lib/systemd/system/sshd.service

[Unit]
Description=OpenSSH server daemon
Documentation=man:sshd(8) man:sshd_config(5)
After=network.target sshd-keygen.service
Wants=sshd-keygen.service

[Service]
Type=notify
EnvironmentFile=-/etc/sysconfig/sshd # `-`表示"抑制错误"，即使/etc/sysconfig/sshd文件不存在，也不会抛出错误
ExecStart=/usr/sbin/sshd -D $OPTIONS
ExecReload=/bin/kill -HUP $MAINPID
KillMode=process
Restart=on-failure
RestartSec=42s

[Install]
WantedBy=multi-user.target


## test.service
[Unit]
Description=test
After=network.target
[Service]
ExecStart=/bin/echo execstart1
ExecStart=
ExecStart=/bin/echo execstart2
ExecStartPost=/bin/echo post1
ExecStartPost=/bin/echo post2
[Install]
WantedBy=multi-user.target
## 输出
Dec 11 17:01:45 [localhost] systemd: Starting test...
Dec 11 17:01:45 [localhost] echo: execstart2
Dec 11 17:01:45 [localhost] echo: post1
Dec 11 17:01:45 [localhost] echo: post2
Dec 11 17:01:45 [localhost] systemd: Started test.

[Unit]
Description=test
After=network.target
[Service]
Type=oneshot # add
ExecStart=/bin/echo execstart1
ExecStart=/bin/echo execstart21
ExecStart=/bin/echo execstart2
ExecStartPost=/bin/echo post1
ExecStartPost=/bin/echo post2
[Install]
WantedBy=multi-user.target

## 输出
# service has more than one ExecStart= setting, which is only allowed for Type=oneshot services. Refusing.
# [Service] 需要添加 Type=oneshot
Dec 11 17:04:23 [localhost] systemd: Starting test...
Dec 11 17:04:23 [localhost] echo: execstart1
Dec 11 17:04:23 [localhost] echo: execstart21
Dec 11 17:04:23 [localhost] echo: execstart2
Dec 11 17:04:23 [localhost] echo: post1
Dec 11 17:04:23 [localhost] echo: post2
Dec 11 17:04:23 [localhost] systemd: Started test.

# supervisord.service

[Unit]
Description=Supervisor daemon

[Service]
Type=forking
ExecStart=/usr/bin/supervisord -c /etc/supervisord.conf
ExecStop=/usr/bin/supervisorctl $OPTIONS shutdown
ExecReload=/usr/bin/supervisorctl $OPTIONS reload
KillMode=process
Restart=on-failure
RestartSec=42s

[Install]
WantedBy=multi-user.target

## systemctl daemon-reload
```

服务：
dhcp samba dns apache mysql nginx zabbix squid varnish lvs keepalived elk mq zookeeper docker openstack hbase mongodb redis

常用：
iptables/firewalld ntp/chrony
timedatectl set-timezone
localectl set-locale LANG=zh_CN.utf8
systemctl start|stop|reload|restart|enable|disable|list-unit-files|kill|poweroff|rescue|set-default

修改网卡名：
vim /etc/sysconfig/grub
GRUB_CMDLINE_LINUX="... net.ifnames=0 biosdevname=0"
grub2-mkconfig -o /boot/grub2/grub.cfg
cp ifcfg-eno166666 ifcfg-eth0
DEVICE=eth0

修改密码：
grub => e
ro crashkernel => rw init=/sysroot/bin/sh
Ctrl + X
chroot /sysroot
passwd root
touch /.autorelabel

tar增量备份：
tar -g /data/bak/snapshot -zcvf /data/bak/data.timestr.tgz -C /path/to/bak/dir/

添加用户&密码：
useradd <user_name> -p <密文>
# useradd test -p $(openssl passwd 'pwd') && usermod -U test

mount使用：
mount -o remount,rw /mnt
mount -t ntfs-3g /dev/sdc /mnt
mount -t iso9660 -o loop centos.iso /mnt
mount -t nfs 192.168.1.1:/data /mnt

rsync使用：
rsync -av /data root@192.168.1.1:/data/bak/dir/
